datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// --- ENUMS ---
enum UserRole {
  PROPERTY_MANAGER
  TENANT
  SERVICE_PRO
}

enum AuthProvider {
  EMAIL_PASSWORD
  GOOGLE
  APPLE
  FACEBOOK
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  PAST_DUE
  EXPIRED
  TRIALING
}

enum PropertyType {
  SINGLE
  MULTI
}

enum PropertyStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum ParkingType {
  NONE
  STREET
  GARAGE
  DRIVEWAY
  DEDICATED_SPOT
  PRIVATE_LOT
  ASSIGNED // Combined 'ASSIGNED' from original and new 'ASSIGNED' from the original single schema
}

enum LaundryType {
  NONE
  IN_UNIT
  ON_SITE
  HOOKUPS
}

enum AirConditioningType {
  NONE
  CENTRAL
  WINDOW
  PORTABLE
  COOLER // Retaining 'COOLER' from the first schema
}

enum FileType {
  PDF
  DOC
  DOCX
  XLS
  XLSX
  IMAGE
  OTHER
}

enum LeaseDuration {
  ONE_MONTH
  TWO_MONTHS
  THREE_MONTHS
  FOUR_MONTHS
  FIVE_MONTHS
  SIX_MONTHS
  SEVEN_MONTHS
  EIGHT_MONTHS
  NINE_MONTHS
  TEN_MONTHS
  ELEVEN_MONTHS
  TWELVE_MONTHS
  THIRTEEN_MONTHS
  FOURTEEN_MONTHS
  FIFTEEN_MONTHS
  SIXTEEN_MONTHS
  SEVENTEEN_MONTHS
  EIGHTEEN_MONTHS
  NINETEEN_MONTHS
  TWENTY_MONTHS
  TWENTY_ONE_MONTHS
  TWENTY_TWO_MONTHS
  TWENTY_THREE_MONTHS
  TWENTY_FOUR_MONTHS
  THIRTY_SIX_PLUS_MONTHS
  CONTACT_FOR_DETAILS
}

enum OtpType {
  EMAIL_VERIFICATION
  DEVICE_VERIFICATION
}

enum ListingType {
  ENTIRE_PROPERTY
  UNIT
}

enum OccupancyStatus {
  VACANT
  OCCUPIED
  PARTIALLY_OCCUPIED
}

enum ListingStatus {
  DRAFT
  ACTIVE
  PAUSED
  EXPIRED
  ARCHIVED
  REMOVED
}

enum ListingVisibility {
  PUBLIC
  PRIVATE
  UNLISTED
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  WITHDRAWN
}

enum ResidenceType {
  RENT
  OWN
}

enum RibbonType {
  NONE
  CHAT
  CUSTOM
}

enum EquipmentStatus {
  ACTIVE
  UNDER_MAINTENANCE
  REPLACED
  DISPOSED
}

enum MaintenanceRequestType {
  MAINTENANCE
  REPAIR
  INSPECTION
  OTHER
}

enum MaintenanceCategory {
  APPLIANCES
  ELECTRICAL
  EXTERIOR
  HOUSEHOLD
  OUTDOORS
  PLUMBING
}

enum MaintenancePriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum MaintenanceStatus {
  NEW
  IN_REVIEW
  ASSIGNED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum AssignmentStatus {
  ASSIGNED
  VENDOR_NOTIFIED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum KeyType {
  DOOR
  MAILBOX
  GARAGE
  GATE
  STORAGE
  OTHER
}

enum KeyStatus {
  AVAILABLE
  ISSUED
  LOST
  DAMAGED
  INACTIVE
}

enum PreferredBeds {
  ANY
  STUDIO
  ONE
  TWO
  THREE
  FOUR
  FIVE_PLUS
}

enum PreferredBaths {
  ANY
  ONE
  TWO
  THREE
  FOUR
  FIVE_PLUS
}

enum TransactionStatus {
  PENDING
  PAID
  OVERDUE
  FAILED
  CANCELLED
}

enum TransactionCategoryType {
  INCOME
  EXPENSE
}

enum TransactionFrequency {
  NONE
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

// --- CORE MODELS ---
model User {
  id               String   @id @default(uuid())
  role             UserRole @default(PROPERTY_MANAGER)
  email            String   @unique
  fullName         String
  phoneCountryCode String?
  phoneNumber      String?
  country          String?
  state            String?
  pincode          String?
  address          String?
  isEmailVerified  Boolean  @default(false)
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  authIdentities              UserAuthIdentity[]
  subscriptions               Subscription[]
  properties                  Property[]              @relation("ManagerProperties")
  devices                     Device[]
  otps                        Otp[]
  // New Relation for Application Invitation
  applicationsInvited         Application[]           @relation("ApplicationInvitedBy")
  // Temporary Relation
  currentListings             Listing[]               @relation("CurrentTenantListings")
  // Maintenance Relations
  maintenanceRequests         MaintenanceRequest[]    @relation("ManagerMaintenanceRequests")
  assignedMaintenanceRequests MaintenanceAssignment[] @relation("AssignedMaintenanceRequests")
  // Transactions where this user is the property manager
  managedTransactions         Transaction[]           @relation("ManagerTransactions")
}

// --- TENANT MODELS ---

model TenantUser {
  id                     String                 @id @default(uuid())
  role                   UserRole               @default(TENANT)
  email                  String                 @unique
  fullName               String
  renterProfileLink      String
  newPlace               Boolean?
  landlordEmail          String?
  preferredLocation      Boolean?
  preferredRentals       String[]               @default([])
  preferredBeds          PreferredBeds?
  preferredBaths         PreferredBaths?
  preferredMinRent       Decimal?
  preferredMaxRent       Decimal?
  preferredPetAllowance  Boolean?
  createdAt              DateTime               @default(now())
  updatedAt              DateTime               @updatedAt

  authIdentities         TenantAuthIdentity[]
  transactions           Transaction[]          @relation("TenantTransactions")
  leases                 Lease[]
  maintenanceRequests    MaintenanceRequest[]
  applications           Application[]
}

model TenantAuthIdentity {
  id             String       @id @default(uuid())
  tenant         TenantUser   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tenantId       String
  provider       AuthProvider
  providerUserId String?
  passwordHash   String?
  lastLoginAt    DateTime?
  createdAt      DateTime     @default(now())

  @@unique([tenantId, provider])
}

model UserAuthIdentity {
  id             String       @id @default(uuid())
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String
  provider       AuthProvider
  providerUserId String?
  passwordHash   String?
  lastLoginAt    DateTime?
  createdAt      DateTime     @default(now())

  @@unique([userId, provider])
}

model Subscription {
  id              String             @id @default(uuid())
  user            User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          String
  planId          String
  status          SubscriptionStatus
  startDate       DateTime
  endDate         DateTime?
  nextBillingDate DateTime?
  cancelledAt     DateTime?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
}

model Otp {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  code      String
  type      OtpType
  expiresAt DateTime
  isUsed    Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([userId, type, isUsed])
  @@index([code, expiresAt, isUsed])
}

model Device {
  id                String    @id @default(uuid())
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId            String
  deviceName        String?   // friendly name, e.g., "Chrome on Windows"
  ipAddress         String?   // optional, don't use as part of uniqueness
  userAgent         String?
  deviceFingerprint String?
  isVerified        Boolean   @default(false)
  deviceTokenHash   String?   // Allow same token hash across different users
  tokenExpiresAt    DateTime?
  isRevoked         Boolean   @default(false)
  lastSeenAt        DateTime  @default(now())
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@unique([userId, deviceTokenHash]) // Same token hash can be used by different users, but only once per user
  @@index([userId, isVerified])
  @@index([deviceTokenHash])
}


// --- PROPERTY MODELS ---
model Address {
  id            String   @id @default(uuid())
  streetAddress String
  city          String
  stateRegion   String
  zipCode       String
  country       String
  propertyId    String   @unique
  property      Property @relation("PropertyAddress", fields: [propertyId], references: [id], onDelete: Cascade)
}

model Property {
  id                      String               @id @default(uuid())
  manager                 User                 @relation("ManagerProperties", fields: [managerId], references: [id])
  managerId               String
  propertyName            String
  yearBuilt               Int?
  mlsNumber               String?
  propertyType            PropertyType
  sizeSqft                Decimal?
  marketRent              Decimal?
  depositAmount           Decimal?
  // Retained coverPhotoUrl from the first schema
  coverPhotoUrl           String?
  // Retained youtubeUrl from the first schema
  youtubeUrl              String?
  ribbonType              RibbonType           @default(NONE)
  ribbonTitle             String?
  address                 Address?             @relation("PropertyAddress")
  description             String?
  // Listing contact information
  listingContactName      String?
  listingPhoneCountryCode String?
  listingPhoneNumber      String?
  listingEmail            String?
  displayPhonePublicly    Boolean              @default(false)
  status                  PropertyStatus       @default(ACTIVE)
  createdAt               DateTime             @default(now())
  updatedAt               DateTime             @updatedAt
  amenities               Amenities?           @relation("PropertyAmenities")
  photos                  PropertyPhoto[]
  attachments             PropertyAttachment[]
  units                   Unit[]
  singleUnitDetails       SingleUnitDetail?
  leasing                 PropertyLeasing?
  listings                Listing[]
  equipment               Equipment[]
  maintenanceRequests     MaintenanceRequest[]
  keys                    Key[]
  leases                  Lease[]
  transactions            Transaction[]           @relation("PropertyTransactions")
}

model PropertyPhoto {
  id         String   @id @default(uuid())
  propertyId String
  photoUrl   String
  isPrimary  Boolean  @default(false)
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@map("property_photos")
}

model PropertyAttachment {
  id          String   @id @default(uuid())
  propertyId  String
  fileUrl     String
  fileType    FileType
  description String?
  uploadedAt  DateTime @default(now())
  property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@map("property_attachments")
}

model Unit {
  id                  String               @id @default(uuid())
  propertyId          String
  unitName            String
  apartmentType       String?
  sizeSqft            Decimal?
  beds                Int?
  baths               Decimal?
  rent                Decimal?
  amenities           Amenities?           @relation("UnitAmenities")
  property            Property             @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  listings            Listing[]
  leasing             PropertyLeasing?     @relation("UnitLeasing")
  equipment           Equipment[]
  maintenanceRequests MaintenanceRequest[]
  keys                Key[]
  leases              Lease[]              @relation("UnitLeases")

  @@index([propertyId])
  @@map("units")
}

model SingleUnitDetail {
  id                  String               @id @default(uuid())
  propertyId          String               @unique
  beds                Int?
  baths               Decimal?
  marketRent          Decimal?
  deposit             Decimal?
  amenities           Amenities?           @relation("SingleUnitAmenities")
  property            Property             @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  leasing             PropertyLeasing?     @relation("SingleUnitDetailLeasing")
  equipment           Equipment[]
  maintenanceRequests MaintenanceRequest[]
  keys                Key[]
  leases              Lease[]              @relation("SingleUnitDetailLeases")

  @@map("single_unit_details")
}

model Equipment {
  id                  String               @id @default(uuid())
  property            Property             @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId          String
  unit                Unit?                @relation(fields: [unitId], references: [id], onDelete: Cascade)
  unitId              String?
  singleUnitDetail    SingleUnitDetail?    @relation(fields: [singleUnitDetailId], references: [id], onDelete: Cascade)
  singleUnitDetailId  String?
  category            String
  brand               String
  model               String
  serialNumber        String
  price               Decimal
  dateOfInstallation  DateTime
  equipmentDetails    String?
  photoUrl            String?
  status              EquipmentStatus      @default(ACTIVE)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  maintenanceRequests MaintenanceRequest[]

  @@index([propertyId])
  @@index([unitId])
  @@index([singleUnitDetailId])
  @@index([status])
  @@map("equipment")
}

model Key {
  id                 String            @id @default(uuid())
  property           Property          @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId         String
  unit               Unit?             @relation(fields: [unitId], references: [id], onDelete: Cascade)
  unitId             String?
  singleUnitDetail   SingleUnitDetail? @relation(fields: [singleUnitDetailId], references: [id], onDelete: Cascade)
  singleUnitDetailId String?
  keyName            String
  keyType            KeyType
  description        String?
  keyPhotoUrl        String?
  status             KeyStatus         @default(AVAILABLE)
  issuedTo           String?
  issuedDate         DateTime?
  returnedDate       DateTime?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  @@index([propertyId])
  @@index([unitId])
  @@index([singleUnitDetailId])
  @@index([status])
  @@map("keys")
}

// --- LEASES & TRANSACTIONS (TENANT RENT) ---

model Lease {
  id                 String            @id @default(uuid())
  tenant             TenantUser        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tenantId           String
  property           Property          @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId         String
  unit               Unit?             @relation("UnitLeases", fields: [unitId], references: [id], onDelete: SetNull)
  unitId             String?
  singleUnitDetail   SingleUnitDetail? @relation("SingleUnitDetailLeases", fields: [singleUnitDetailId], references: [id], onDelete: SetNull)
  singleUnitDetailId String?
  startDate          DateTime
  endDate            DateTime?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  @@index([tenantId])
  @@index([propertyId])
  @@index([unitId])
  @@index([singleUnitDetailId])
}

// --- TRANSACTION / PAYMENT MODELS ---

model TransactionCategory {
  id          String                 @id @default(uuid())
  name        String
  type        TransactionCategoryType
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt

  transactions Transaction[]
}

model TransactionSchedule {
  id          String               @id @default(uuid())
  frequency   TransactionFrequency
  startDate   DateTime
  endDate     DateTime?
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt

  transactions Transaction[]
}

model Transaction {
  id                String              @id @default(uuid())
  status            TransactionStatus   @default(PENDING)
  dueDate           DateTime
  amountTotal       Decimal
  balanceRemaining  Decimal

  // Category
  category          TransactionCategory @relation(fields: [categoryId], references: [id])
  categoryId        String

  // Tenant renting the unit/property
  tenant            TenantUser?         @relation("TenantTransactions", fields: [tenantId], references: [id])
  tenantId          String?

  // Property associated with the charge
  property          Property?           @relation("PropertyTransactions", fields: [propertyId], references: [id])
  propertyId        String?

  // Property manager who owns/controls this property
  propertyManager   User                @relation("ManagerTransactions", fields: [propertyManagerId], references: [id])
  propertyManagerId String

  // Schedule (recurring)
  schedule          TransactionSchedule? @relation(fields: [scheduleId], references: [id])
  scheduleId        String?

  // Payments
  payments          Payment[]

  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([status])
  @@index([dueDate])
  @@index([propertyId])
  @@index([tenantId])
  @@index([propertyManagerId])
}

model Payment {
  id              String       @id @default(uuid())
  transaction     Transaction  @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  transactionId   String
  paidAmount      Decimal
  paidOn          DateTime
  method          String?
  createdAt       DateTime     @default(now())
}

// --- MAINTENANCE MODELS ---
// Service Provider model for external vendors/contractors
model ServiceProvider {
  id             String   @id @default(uuid())
  photoUrl       String?
  firstName      String
  middleName     String?
  lastName       String
  phoneNumber    String
  companyName    String
  companyWebsite String?
  faxNumber      String?
  email          String
  category       String
  subcategory    String?
  address        String
  city           String
  state          String
  zipCode        String
  country        String
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  assignments MaintenanceAssignment[]

  @@map("service_providers")
}

model MaintenanceRequest {
  id                 String                  @id @default(uuid())
  manager            User                    @relation("ManagerMaintenanceRequests", fields: [managerId], references: [id])
  managerId          String
  property           Property                @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId         String
  unit               Unit?                   @relation(fields: [unitId], references: [id], onDelete: Cascade)
  unitId             String?
  singleUnitDetail   SingleUnitDetail?       @relation(fields: [singleUnitDetailId], references: [id], onDelete: Cascade)
  singleUnitDetailId String?
  requestType        MaintenanceRequestType?
  equipmentLinked    Boolean                 @default(false)
  equipment          Equipment?              @relation(fields: [equipmentId], references: [id], onDelete: SetNull)
  equipmentId        String?
  category           MaintenanceCategory
  subcategory        String
  issue              String?
  subissue           String?
  title              String
  problemDetails     String?
  priority           MaintenancePriority     @default(MEDIUM)
  status             MaintenanceStatus       @default(NEW)
  internalNotes      String?

  // Optional tenant linked to this request
  tenant            TenantUser?         @relation(fields: [tenantId], references: [id], onDelete: SetNull)
  tenantId          String?
  tenantInformation String?

  requestedAt DateTime  @default(now())
  dueDate     DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  photos      MaintenancePhoto[]
  assignments MaintenanceAssignment[]
  materials   MaintenanceMaterial[]

  @@index([managerId])
  @@index([propertyId])
  @@index([unitId])
  @@index([singleUnitDetailId])
  @@index([equipmentId])
  @@index([tenantId])
  @@index([status])
  @@index([priority])
  @@index([requestedAt])
  @@map("maintenance_requests")
}

model MaintenancePhoto {
  id          String             @id @default(uuid())
  request     MaintenanceRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  requestId   String
  photoUrl    String?
  videoUrl    String?
  description String?
  isPrimary   Boolean            @default(false)
  createdAt   DateTime           @default(now())

  @@index([requestId])
  @@map("maintenance_photos")
}

model MaintenanceAssignment {
  id                String             @id @default(uuid())
  request           MaintenanceRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  requestId         String
  serviceProvider   ServiceProvider?   @relation(fields: [serviceProviderId], references: [id], onDelete: SetNull)
  serviceProviderId String?
  assignedToUser    User?              @relation("AssignedMaintenanceRequests", fields: [assignedToUserId], references: [id], onDelete: SetNull)
  assignedToUserId  String?
  scheduledDate     DateTime?
  status            AssignmentStatus   @default(ASSIGNED)
  notes             String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  @@index([requestId])
  @@index([serviceProviderId])
  @@index([assignedToUserId])
  @@index([status])
  @@map("maintenance_assignments")
}

// Materials Component - Supplies/materials needed for maintenance
model MaintenanceMaterial {
  id           String             @id @default(uuid())
  request      MaintenanceRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  requestId    String
  materialName String
  quantity     Int                @default(1)
  unit         String? // e.g., "pieces", "gallons", "feet"
  description  String?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt

  @@index([requestId])
  @@map("maintenance_materials")
}

model Amenities {
  id                 String              @id @default(uuid())
  propertyId         String?             @unique
  unitId             String?             @unique
  singleUnitDetailId String?             @unique
  parking            ParkingType
  laundry            LaundryType
  airConditioning    AirConditioningType
  propertyFeatures   String[]            @default([])
  propertyAmenities  String[]            @default([])
  property           Property?           @relation("PropertyAmenities", fields: [propertyId], references: [id], onDelete: Cascade)
  unit               Unit?               @relation("UnitAmenities", fields: [unitId], references: [id], onDelete: Cascade)
  singleUnitDetail   SingleUnitDetail?   @relation("SingleUnitAmenities", fields: [singleUnitDetailId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@map("amenities")
}

// --- LEASING & LISTING MODELS ---
model PropertyLeasing {
  id                 String            @id @default(uuid())
  // The property this leasing term belongs to (for multi-unit properties)
  property           Property          @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId         String            @unique
  // The specific unit this leasing term applies to (if applicable)
  unit               Unit?             @relation("UnitLeasing", fields: [unitId], references: [id], onDelete: Cascade)
  unitId             String?           @unique
  // The single unit detail this leasing term applies to (if propertyType is SINGLE)
  singleUnitDetail   SingleUnitDetail? @relation("SingleUnitDetailLeasing", fields: [singleUnitDetailId], references: [id], onDelete: Cascade)
  singleUnitDetailId String?           @unique

  monthlyRent             Decimal
  securityDeposit         Decimal?
  amountRefundable        Decimal?
  dateAvailable           DateTime
  minLeaseDuration        LeaseDuration
  maxLeaseDuration        LeaseDuration
  description             String?
  petsAllowed             Boolean       @default(false)
  petCategory             String[]      @default([])
  petDeposit              Decimal?
  petFee                  Decimal?
  petDescription          String?
  onlineRentalApplication Boolean       @default(false)
  requireApplicationFee   Boolean       @default(false)
  applicationFee          Decimal?
  // REMOVED: applicantName, applicantContact, applicantEmail (Belong in Application)
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt

  applications Application[]

  @@index([propertyId])
  @@index([unitId])
  @@index([singleUnitDetailId])
  @@map("property_leasing")
}

model Listing {
  id         String   @id @default(uuid())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId String

  unit   Unit?   @relation(fields: [unitId], references: [id], onDelete: Cascade)
  unitId String?

  // Temporary relation to tenant
  currentTenant   User?   @relation("CurrentTenantListings", fields: [currentTenantId], references: [id], onDelete: SetNull)
  currentTenantId String?

  listingType     ListingType       @default(ENTIRE_PROPERTY)
  listingStatus   ListingStatus     @default(DRAFT)
  occupancyStatus OccupancyStatus   @default(VACANT)
  visibility      ListingVisibility @default(PUBLIC)

  // Pricing / leasing fields (overrides)
  listingPrice     Decimal?
  monthlyRent      Decimal?
  securityDeposit  Decimal?
  amountRefundable Decimal?
  minLeaseDuration LeaseDuration?
  maxLeaseDuration LeaseDuration?

  // Availability & lifecycle dates
  listedAt      DateTime  @default(now())
  availableFrom DateTime?
  expiresAt     DateTime?
  archivedAt    DateTime?
  updatedAt     DateTime  @updatedAt
  createdAt     DateTime  @default(now())

  // Visibility / meta
  isActive                   Boolean  @default(true)
  petsAllowed                Boolean  @default(false)
  petCategory                String[] @default([])
  applicationFee             Decimal?
  onlineApplicationAvailable Boolean  @default(false)

  // External metadata
  externalListingUrl String?
  source             String?

  // Free-form description or overrides for what appears on the listing
  title       String?
  description String?

  @@index([propertyId])
  @@index([unitId])
  @@index([listingStatus])
  @@index([occupancyStatus])
  @@map("listings")
}

// --- APPLICATION MODELS ---
model Application {
  id              String            @id @default(uuid())
  // The terms the applicant is applying for
  leasing         PropertyLeasing   @relation(fields: [leasingId], references: [id], onDelete: Cascade)
  leasingId       String
  // The user who invited the applicant (Property Manager)
  invitedBy       User?             @relation("ApplicationInvitedBy", fields: [invitedById], references: [id], onDelete: SetNull)
  invitedById     String?
  status          ApplicationStatus @default(DRAFT)
  applicationDate DateTime          @default(now())
  moveInDate      DateTime
  bio             String?
  imageUrl        String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  // Optional tenant linked to this application
  tenant          TenantUser?       @relation(fields: [tenantId], references: [id], onDelete: SetNull)
  tenantId        String?

  applicants          Applicant[]
  occupants           Occupant[]
  pets                Pet[]
  vehicles            Vehicle[]
  residenceHistory    ResidenceHistory[]
  incomeDetails       IncomeDetail[]
  emergencyContacts   EmergencyContact[]
  referenceContacts   ReferenceContact[]
  backgroundQuestions BackgroundQuestion?

  @@index([leasingId])
  @@index([invitedById])
  @@index([tenantId])
  @@map("applications")
}

model Applicant {
  id            String      @id @default(uuid())
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  applicationId String
  firstName     String
  middleName    String?
  lastName      String
  email         String
  phoneNumber   String
  dateOfBirth   DateTime
  isPrimary     Boolean     @default(true) // Is this the primary applicant?

  @@index([applicationId])
  @@map("applicants")
}

model Occupant {
  id            String      @id @default(uuid())
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  applicationId String
  name          String
  email         String?
  phoneNumber   String?
  dateOfBirth   DateTime
  relationship  String

  @@index([applicationId])
  @@map("occupants")
}

model Pet {
  id            String      @id @default(uuid())
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  applicationId String
  type          String
  name          String
  weight        Decimal?
  breed         String
  photoUrl      String?

  @@index([applicationId])
  @@map("pets")
}

model Vehicle {
  id            String      @id @default(uuid())
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  applicationId String
  type          String
  make          String
  model         String
  year          Int
  color         String
  licensePlate  String
  registeredIn  String

  @@index([applicationId])
  @@map("vehicles")
}

model ResidenceHistory {
  id             String        @id @default(uuid())
  application    Application   @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  applicationId  String
  residenceType  ResidenceType
  monthlyRent    Decimal?
  moveInDate     DateTime
  moveOutDate    DateTime?
  landlordName   String
  landlordEmail  String
  landlordPhone  String
  address        String
  city           String
  state          String
  zipCode        String
  country        String
  additionalInfo String?

  @@index([applicationId])
  @@map("residence_history")
}

model IncomeDetail {
  id              String      @id @default(uuid())
  application     Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  applicationId   String
  incomeType      String
  companyName     String
  positionTitle   String
  startDate       DateTime
  monthlyIncome   Decimal
  officeAddress   String
  supervisorName  String
  supervisorPhone String
  additionalInfo  String?

  @@index([applicationId])
  @@map("income_details")
}

model EmergencyContact {
  id            String      @id @default(uuid())
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  applicationId String
  contactName   String
  phoneNumber   String
  email         String
  relationship  String
  details       String?

  @@index([applicationId])
  @@map("emergency_contacts")
}

model ReferenceContact {
  id            String      @id @default(uuid())
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  applicationId String
  contactName   String
  phoneNumber   String
  email         String
  relationship  String
  yearsKnown    Int

  @@index([applicationId])
  @@map("reference_contacts")
}

model BackgroundQuestion {
  id             String      @id @default(uuid())
  application    Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  applicationId  String      @unique
  smoke          Boolean
  militaryMember Boolean
  criminalRecord Boolean
  bankruptcy     Boolean
  refusedRent    Boolean
  evicted        Boolean

  @@map("background_questions")
}
