generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                          String                  @id @default(uuid())
  role                        UserRole                @default(PROPERTY_MANAGER)
  email                       String                  @unique
  fullName                    String
  phoneCountryCode            String?
  phoneNumber                 String?
  country                     String?
  state                       String?
  pincode                     String?
  address                     String?
  isEmailVerified             Boolean                 @default(false)
  isActive                    Boolean                 @default(true)
  createdAt                   DateTime                @default(now())
  updatedAt                   DateTime                @updatedAt
  devices                     Device[]
  otps                        Otp[]
  properties                  Property[]              @relation("ManagerProperties")
  subscriptions               Subscription[]
  authIdentities              UserAuthIdentity[]
  applicationsInvited         Application[]           @relation("ApplicationInvitedBy")
  currentListings             Listing[]               @relation("CurrentTenantListings")
  assignedMaintenanceRequests MaintenanceAssignment[] @relation("AssignedMaintenanceRequests")
  maintenanceRequests         MaintenanceRequest[]    @relation("ManagerMaintenanceRequests")
  tasks                       tasks[]
}

model UserAuthIdentity {
  id             String       @id @default(uuid())
  userId         String
  provider       AuthProvider
  providerUserId String?
  passwordHash   String?
  lastLoginAt    DateTime?
  createdAt      DateTime     @default(now())
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, provider])
}

model Subscription {
  id              String             @id @default(uuid())
  userId          String
  planId          String
  status          SubscriptionStatus
  startDate       DateTime
  endDate         DateTime?
  nextBillingDate DateTime?
  cancelledAt     DateTime?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  user            User               @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Otp {
  id        String   @id @default(uuid())
  userId    String
  code      String
  type      OtpType
  expiresAt DateTime
  isUsed    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, type, isUsed])
  @@index([code, expiresAt, isUsed])
}

model Device {
  id                String    @id @default(uuid())
  userId            String
  ipAddress         String?
  userAgent         String?
  deviceFingerprint String?
  isVerified        Boolean   @default(false)
  lastSeenAt        DateTime  @default(now())
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  deviceTokenHash   String?
  isRevoked         Boolean   @default(false)
  tokenExpiresAt    DateTime?
  deviceName        String?
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, deviceTokenHash])
  @@index([userId, isVerified])
  @@index([deviceTokenHash])
}

model Address {
  id            String   @id @default(uuid())
  streetAddress String
  city          String
  stateRegion   String
  zipCode       String
  country       String
  propertyId    String   @unique
  property      Property @relation("PropertyAddress", fields: [propertyId], references: [id], onDelete: Cascade)
}

model Property {
  id                      String               @id @default(uuid())
  managerId               String
  propertyName            String
  yearBuilt               Int?
  mlsNumber               String?
  propertyType            PropertyType
  sizeSqft                Decimal?
  marketRent              Decimal?
  depositAmount           Decimal?
  description             String?
  coverPhotoUrl           String?
  youtubeUrl              String?
  status                  PropertyStatus       @default(ACTIVE)
  createdAt               DateTime             @default(now())
  updatedAt               DateTime             @updatedAt
  ribbonTitle             String?
  ribbonType              RibbonType           @default(NONE)
  displayPhonePublicly    Boolean              @default(false)
  listingContactName      String?
  listingEmail            String?
  listingPhoneCountryCode String?
  listingPhoneNumber      String?
  address                 Address?             @relation("PropertyAddress")
  manager                 User                 @relation("ManagerProperties", fields: [managerId], references: [id])
  amenities               Amenities?           @relation("PropertyAmenities")
  equipment               Equipment[]
  keys                    Key[]
  listings                Listing[]
  maintenanceRequests     MaintenanceRequest[]
  attachments             PropertyAttachment[]
  leasing                 PropertyLeasing?
  photos                  PropertyPhoto[]
  singleUnitDetails       SingleUnitDetail?
  units                   Unit[]
}

model PropertyPhoto {
  id         String   @id @default(uuid())
  propertyId String
  photoUrl   String
  isPrimary  Boolean  @default(false)
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@map("property_photos")
}

model PropertyAttachment {
  id          String   @id @default(uuid())
  propertyId  String
  fileUrl     String
  fileType    FileType
  description String?
  uploadedAt  DateTime @default(now())
  property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@map("property_attachments")
}

model Unit {
  id                  String               @id @default(uuid())
  propertyId          String
  unitName            String
  apartmentType       String?
  sizeSqft            Decimal?
  beds                Int?
  baths               Decimal?
  rent                Decimal?
  deposit             Decimal?
  coverPhotoUrl       String?
  description         String?
  amenities           Amenities?           @relation("UnitAmenities")
  equipment           Equipment[]
  keys                Key[]
  listings            Listing[]
  maintenanceRequests MaintenanceRequest[]
  leasing             PropertyLeasing?     @relation("UnitLeasing")
  photos              UnitPhoto[]
  property            Property             @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@map("units")
}

model UnitPhoto {
  id         String   @id @default(uuid())
  unitId     String
  photoUrl   String
  isPrimary  Boolean  @default(false)
  createdAt  DateTime @default(now())
  unit       Unit     @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([unitId])
  @@map("unit_photos")
}

model SingleUnitDetail {
  id                  String               @id @default(uuid())
  propertyId          String               @unique
  beds                Int?
  baths               Decimal?
  marketRent          Decimal?
  deposit             Decimal?
  amenities           Amenities?           @relation("SingleUnitAmenities")
  equipment           Equipment[]
  keys                Key[]
  maintenanceRequests MaintenanceRequest[]
  leasing             PropertyLeasing?     @relation("SingleUnitDetailLeasing")
  property            Property             @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@map("single_unit_details")
}

model Equipment {
  id                  String               @id @default(uuid())
  propertyId          String
  unitId              String?
  singleUnitDetailId  String?
  category            String
  brand               String
  model               String
  serialNumber        String
  price               Decimal
  dateOfInstallation  DateTime
  equipmentDetails    String?
  photoUrl            String?
  status              EquipmentStatus      @default(ACTIVE)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  property            Property             @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  singleUnitDetail    SingleUnitDetail?    @relation(fields: [singleUnitDetailId], references: [id], onDelete: Cascade)
  unit                Unit?                @relation(fields: [unitId], references: [id], onDelete: Cascade)
  maintenanceRequests MaintenanceRequest[]

  @@index([propertyId])
  @@index([unitId])
  @@index([singleUnitDetailId])
  @@index([status])
  @@map("equipment")
}

model Key {
  id                 String            @id @default(uuid())
  propertyId         String
  unitId             String?
  singleUnitDetailId String?
  keyName            String
  keyType            KeyType
  description        String?
  keyPhotoUrl        String?
  status             KeyStatus         @default(AVAILABLE)
  issuedTo           String?
  issuedDate         DateTime?
  returnedDate       DateTime?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  property           Property          @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  singleUnitDetail   SingleUnitDetail? @relation(fields: [singleUnitDetailId], references: [id], onDelete: Cascade)
  unit               Unit?             @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([unitId])
  @@index([singleUnitDetailId])
  @@index([status])
  @@map("keys")
}

model ServiceProvider {
  id             String                  @id @default(uuid())
  photoUrl       String?
  firstName      String
  middleName     String?
  lastName       String
  phoneNumber    String
  companyName    String
  companyWebsite String?
  faxNumber      String?
  email          String
  category       String
  subcategory    String?
  address        String
  city           String
  state          String
  zipCode        String
  country        String
  isActive       Boolean                 @default(true)
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  assignments    MaintenanceAssignment[]

  @@map("service_providers")
}

model MaintenanceRequest {
  id                 String                  @id @default(uuid())
  managerId          String
  propertyId         String
  unitId             String?
  singleUnitDetailId String?
  requestType        MaintenanceRequestType?
  equipmentLinked    Boolean                 @default(false)
  equipmentId        String?
  category           MaintenanceCategory
  subcategory        String
  issue              String?
  subissue           String?
  title              String
  problemDetails     String?
  priority           MaintenancePriority     @default(MEDIUM)
  status             MaintenanceStatus       @default(NEW)
  internalNotes      String?
  tenantInformation  String?
  requestedAt        DateTime                @default(now())
  dueDate            DateTime?
  completedAt        DateTime?
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt
  assignments        MaintenanceAssignment[]
  materials          MaintenanceMaterial[]
  photos             MaintenancePhoto[]
  equipment          Equipment?              @relation(fields: [equipmentId], references: [id])
  manager            User                    @relation("ManagerMaintenanceRequests", fields: [managerId], references: [id])
  property           Property                @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  singleUnitDetail   SingleUnitDetail?       @relation(fields: [singleUnitDetailId], references: [id], onDelete: Cascade)
  unit               Unit?                   @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([managerId])
  @@index([propertyId])
  @@index([unitId])
  @@index([singleUnitDetailId])
  @@index([equipmentId])
  @@index([status])
  @@index([priority])
  @@index([requestedAt])
  @@map("maintenance_requests")
}

model MaintenancePhoto {
  id          String             @id @default(uuid())
  requestId   String
  photoUrl    String?
  videoUrl    String?
  description String?
  isPrimary   Boolean            @default(false)
  createdAt   DateTime           @default(now())
  request     MaintenanceRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)

  @@index([requestId])
  @@map("maintenance_photos")
}

model MaintenanceAssignment {
  id                String             @id @default(uuid())
  requestId         String
  serviceProviderId String?
  assignedToUserId  String?
  scheduledDate     DateTime?
  status            AssignmentStatus   @default(ASSIGNED)
  notes             String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  assignedToUser    User?              @relation("AssignedMaintenanceRequests", fields: [assignedToUserId], references: [id])
  request           MaintenanceRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  serviceProvider   ServiceProvider?   @relation(fields: [serviceProviderId], references: [id])

  @@index([requestId])
  @@index([serviceProviderId])
  @@index([assignedToUserId])
  @@index([status])
  @@map("maintenance_assignments")
}

model MaintenanceMaterial {
  id           String             @id @default(uuid())
  requestId    String
  materialName String
  quantity     Int                @default(1)
  unit         String?
  description  String?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  request      MaintenanceRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)

  @@index([requestId])
  @@map("maintenance_materials")
}

model Amenities {
  id                 String              @id @default(uuid())
  propertyId         String?             @unique
  unitId             String?             @unique
  singleUnitDetailId String?             @unique
  parking            ParkingType
  laundry            LaundryType
  airConditioning    AirConditioningType
  propertyFeatures   String[]            @default([])
  propertyAmenities  String[]            @default([])
  property           Property?           @relation("PropertyAmenities", fields: [propertyId], references: [id], onDelete: Cascade)
  singleUnitDetail   SingleUnitDetail?   @relation("SingleUnitAmenities", fields: [singleUnitDetailId], references: [id], onDelete: Cascade)
  unit               Unit?               @relation("UnitAmenities", fields: [unitId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@map("amenities")
}

model PropertyLeasing {
  id                      String            @id @default(uuid())
  propertyId              String            @unique
  unitId                  String?           @unique
  singleUnitDetailId      String?           @unique
  monthlyRent             Decimal
  securityDeposit         Decimal?
  amountRefundable        Decimal?
  dateAvailable           DateTime
  minLeaseDuration        LeaseDuration
  maxLeaseDuration        LeaseDuration
  description             String?
  petsAllowed             Boolean           @default(false)
  petCategory             String[]          @default([])
  petDeposit              Decimal?
  petFee                  Decimal?
  petDescription          String?
  onlineRentalApplication Boolean           @default(false)
  requireApplicationFee   Boolean           @default(false)
  applicationFee          Decimal?
  createdAt               DateTime          @default(now())
  updatedAt               DateTime          @updatedAt
  applications            Application[]
  property                Property          @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  singleUnitDetail        SingleUnitDetail? @relation("SingleUnitDetailLeasing", fields: [singleUnitDetailId], references: [id], onDelete: Cascade)
  unit                    Unit?             @relation("UnitLeasing", fields: [unitId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([unitId])
  @@index([singleUnitDetailId])
  @@map("property_leasing")
}

model Listing {
  id                         String            @id @default(uuid())
  propertyId                 String
  unitId                     String?
  currentTenantId            String?
  listingType                ListingType       @default(ENTIRE_PROPERTY)
  listingStatus              ListingStatus     @default(DRAFT)
  occupancyStatus            OccupancyStatus   @default(VACANT)
  visibility                 ListingVisibility @default(PUBLIC)
  listingPrice               Decimal?
  monthlyRent                Decimal?
  securityDeposit            Decimal?
  amountRefundable           Decimal?
  minLeaseDuration           LeaseDuration?
  maxLeaseDuration           LeaseDuration?
  listedAt                   DateTime          @default(now())
  availableFrom              DateTime?
  expiresAt                  DateTime?
  archivedAt                 DateTime?
  updatedAt                  DateTime          @updatedAt
  createdAt                  DateTime          @default(now())
  isActive                   Boolean           @default(true)
  petsAllowed                Boolean           @default(false)
  petCategory                String[]          @default([])
  applicationFee             Decimal?
  onlineApplicationAvailable Boolean           @default(false)
  externalListingUrl         String?
  source                     String?
  title                      String?
  description                String?
  currentTenant              User?             @relation("CurrentTenantListings", fields: [currentTenantId], references: [id])
  property                   Property          @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  unit                       Unit?             @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([unitId])
  @@index([listingStatus])
  @@index([occupancyStatus])
  @@map("listings")
}

model Application {
  id                  String              @id @default(uuid())
  leasingId           String
  invitedById         String?
  status              ApplicationStatus   @default(DRAFT)
  applicationDate     DateTime            @default(now())
  moveInDate          DateTime
  bio                 String?
  imageUrl            String?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  applicants          Applicant[]
  invitedBy           User?               @relation("ApplicationInvitedBy", fields: [invitedById], references: [id])
  leasing             PropertyLeasing     @relation(fields: [leasingId], references: [id], onDelete: Cascade)
  backgroundQuestions BackgroundQuestion?
  emergencyContacts   EmergencyContact[]
  incomeDetails       IncomeDetail[]
  occupants           Occupant[]
  pets                Pet[]
  referenceContacts   ReferenceContact[]
  residenceHistory    ResidenceHistory[]
  vehicles            Vehicle[]

  @@index([leasingId])
  @@index([invitedById])
  @@map("applications")
}

model Applicant {
  id            String      @id @default(uuid())
  applicationId String
  firstName     String
  middleName    String?
  lastName      String
  email         String
  phoneNumber   String
  dateOfBirth   DateTime
  isPrimary     Boolean     @default(true)
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
  @@map("applicants")
}

model Occupant {
  id            String      @id @default(uuid())
  applicationId String
  name          String
  email         String?
  phoneNumber   String?
  dateOfBirth   DateTime
  relationship  String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
  @@map("occupants")
}

model Pet {
  id            String      @id @default(uuid())
  applicationId String
  type          String
  name          String
  weight        Decimal?
  breed         String
  photoUrl      String?
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
  @@map("pets")
}

model Vehicle {
  id            String      @id @default(uuid())
  applicationId String
  type          String
  make          String
  model         String
  year          Int
  color         String
  licensePlate  String
  registeredIn  String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
  @@map("vehicles")
}

model ResidenceHistory {
  id             String        @id @default(uuid())
  applicationId  String
  residenceType  ResidenceType
  monthlyRent    Decimal?
  moveInDate     DateTime
  moveOutDate    DateTime?
  landlordName   String
  landlordEmail  String
  landlordPhone  String
  address        String
  city           String
  state          String
  zipCode        String
  country        String
  additionalInfo String?
  application    Application   @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
  @@map("residence_history")
}

model IncomeDetail {
  id              String      @id @default(uuid())
  applicationId   String
  incomeType      String
  companyName     String
  positionTitle   String
  startDate       DateTime
  monthlyIncome   Decimal
  officeAddress   String
  supervisorName  String
  supervisorPhone String
  additionalInfo  String?
  application     Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
  @@map("income_details")
}

model EmergencyContact {
  id            String      @id @default(uuid())
  applicationId String
  contactName   String
  phoneNumber   String
  email         String
  relationship  String
  details       String?
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
  @@map("emergency_contacts")
}

model ReferenceContact {
  id            String      @id @default(uuid())
  applicationId String
  contactName   String
  phoneNumber   String
  email         String
  relationship  String
  yearsKnown    Int
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
  @@map("reference_contacts")
}

model BackgroundQuestion {
  id             String      @id @default(uuid())
  applicationId  String      @unique
  smoke          Boolean
  militaryMember Boolean
  criminalRecord Boolean
  bankruptcy     Boolean
  refusedRent    Boolean
  evicted        Boolean
  application    Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@map("background_questions")
}



model tasks {
  id          String         @id
  userId      String
  title       String
  status      TaskStatus     @default(OPEN)
  description String?
  date        DateTime?
  time        String?
  assignee    String?
  propertyId  String?
  recurring   Boolean        @default(false)
  frequency   TaskFrequency?
  endDate     DateTime?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime
  User        User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([date])
  @@index([propertyId])
  @@index([status])
  @@index([userId])

}

enum UserRole {
  PROPERTY_MANAGER
  TENANT
  SERVICE_PRO
}

enum AuthProvider {
  EMAIL_PASSWORD
  GOOGLE
  APPLE
  FACEBOOK
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  PAST_DUE
  EXPIRED
  TRIALING
}

enum PropertyType {
  SINGLE
  MULTI
}

enum PropertyStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum ParkingType {
  NONE
  STREET
  GARAGE
  DRIVEWAY
  DEDICATED_SPOT
  PRIVATE_LOT
  ASSIGNED
}

enum LaundryType {
  NONE
  IN_UNIT
  ON_SITE
  HOOKUPS
}

enum AirConditioningType {
  NONE
  CENTRAL
  WINDOW
  PORTABLE
  COOLER
}

enum FileType {
  PDF
  DOC
  DOCX
  XLS
  XLSX
  IMAGE
  OTHER
}

enum LeaseDuration {
  ONE_MONTH
  TWO_MONTHS
  THREE_MONTHS
  FOUR_MONTHS
  FIVE_MONTHS
  SIX_MONTHS
  SEVEN_MONTHS
  EIGHT_MONTHS
  NINE_MONTHS
  TEN_MONTHS
  ELEVEN_MONTHS
  TWELVE_MONTHS
  THIRTEEN_MONTHS
  FOURTEEN_MONTHS
  FIFTEEN_MONTHS
  SIXTEEN_MONTHS
  SEVENTEEN_MONTHS
  EIGHTEEN_MONTHS
  NINETEEN_MONTHS
  TWENTY_MONTHS
  TWENTY_ONE_MONTHS
  TWENTY_TWO_MONTHS
  TWENTY_THREE_MONTHS
  TWENTY_FOUR_MONTHS
  THIRTY_SIX_PLUS_MONTHS
  CONTACT_FOR_DETAILS
}

enum OtpType {
  EMAIL_VERIFICATION
  DEVICE_VERIFICATION
}

enum ListingType {
  ENTIRE_PROPERTY
  UNIT
}

enum OccupancyStatus {
  VACANT
  OCCUPIED
  PARTIALLY_OCCUPIED
}

enum ListingStatus {
  DRAFT
  ACTIVE
  PAUSED
  EXPIRED
  ARCHIVED
  REMOVED
}

enum ListingVisibility {
  PUBLIC
  PRIVATE
  UNLISTED
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  WITHDRAWN
}

enum ResidenceType {
  RENT
  OWN
}

enum RibbonType {
  NONE
  CHAT
  CUSTOM
}

enum EquipmentStatus {
  ACTIVE
  UNDER_MAINTENANCE
  REPLACED
  DISPOSED
}

enum MaintenanceRequestType {
  MAINTENANCE
  REPAIR
  INSPECTION
  OTHER
}

enum MaintenanceCategory {
  APPLIANCES
  ELECTRICAL
  EXTERIOR
  HOUSEHOLD
  OUTDOORS
  PLUMBING
}

enum MaintenancePriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum MaintenanceStatus {
  NEW
  IN_REVIEW
  ASSIGNED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum AssignmentStatus {
  ASSIGNED
  VENDOR_NOTIFIED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum KeyType {
  DOOR
  MAILBOX
  GARAGE
  GATE
  STORAGE
  OTHER
}

enum KeyStatus {
  AVAILABLE
  ISSUED
  LOST
  DAMAGED
  INACTIVE
}

enum TaskStatus {
  OPEN
  RESOLVED
}

enum TaskFrequency {
  DAILY
  WEEKLY
  EVERY_TWO_WEEKS
  MONTHLY
  QUARTERLY
  EVERY_SIX_MONTHS
  YEARLY
}
